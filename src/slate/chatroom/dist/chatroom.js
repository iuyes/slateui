define("slate/chatroom/1.0.0/chatroom",["$"],function(a){var b=a("$");b.fn.chatroom=function(a){var c,d=b(this),e=d.selector||"",f=(new Date).getTime(),g=[],h=arguments[0],i="string"==typeof h,j=[].slice.call(arguments,1);return b(this).each(function(){var c,d,k,l,m,n,o,p=b.extend(!0,{},b.fn.chatroom.settings,a),q=p.className,r=p.namespace,s=p.selector,t=p.error,u=b(this),v=u.find(s.expandButton),w=u.find(s.userListButton),x=u.find(s.userList),y=(u.find(s.room),u.find(s.userCount)),z=u.find(s.log),A=(u.find(s.message),u.find(s.messageInput)),B=u.find(s.messageButton),C=u.data("module"),D=this,E="",F={};o={width:{log:z.width(),userList:x.outerWidth()},initialize:function(){return void 0===Pusher&&o.error(t.pusher),void 0===p.key||void 0===p.channelName?(o.error(t.key),!1):p.endpoint.message||p.endpoint.authentication?(n=new Pusher(p.key),Pusher.channel_auth_endpoint=p.endpoint.authentication,c=n.subscribe(p.channelName),c.bind("pusher:subscription_succeeded",o.user.list.create),c.bind("pusher:subscription_error",o.error),c.bind("pusher:member_added",o.user.joined),c.bind("pusher:member_removed",o.user.left),c.bind("update_messages",o.message.receive),b.each(p.customEvents,function(a,b){c.bind(a,b)}),w.on("click."+r,o.event.toggleUserList),v.on("click."+r,o.event.toggleExpand),A.on("keydown."+r,o.event.input.keydown).on("keyup."+r,o.event.input.keyup),B.on("mouseenter."+r,o.event.hover).on("mouseleave."+r,o.event.hover).on("click."+r,o.event.submit),z.animate({scrollTop:z.prop("scrollHeight")},400),u.data("module",o).addClass(q.loading),void 0):(o.error(t.endpoint),!1)},refresh:function(){w.removeClass(q.active),o.width={log:z.width(),userList:x.outerWidth()},w.hasClass(q.active)&&o.user.list.hide(),u.data("module",o)},user:{updateCount:function(){p.userCount&&(F=u.data("users"),l=0,b.each(F,function(){l++}),y.html(p.templates.userCount(l)))},joined:function(a){F=u.data("users"),"anonymous"!=a.id&&void 0===F[a.id]&&(F[a.id]=a.info,p.randomColor&&void 0===a.info.color&&(a.info.color=p.templates.color(a.id)),E=p.templates.userList(a.info),a.info.isAdmin?b(E).prependTo(x):b(E).appendTo(x),p.partingMessages&&(z.append(p.templates.joined(a.info)),o.message.scroll.test()),o.user.updateCount())},left:function(a){F=u.data("users"),void 0!==a&&"anonymous"!==a.id&&(delete F[a.id],u.data("users",F),x.find("[data-id="+a.id+"]").remove(),p.partingMessages&&(z.append(p.templates.left(a.info)),o.message.scroll.test()),o.user.updateCount())},list:{create:function(a){F={},a.each(function(a){"anonymous"!==a.id&&"undefined"!==a.id&&(p.randomColor&&void 0===a.info.color&&(a.info.color=p.templates.color(a.id)),E=a.info.isAdmin?p.templates.userList(a.info)+E:E+p.templates.userList(a.info),F[a.id]=a.info)}),u.data("users",F).data("user",F[a.me.id]).removeClass(q.loading),x.html(E),o.user.updateCount(),b.proxy(p.onJoin,x.children())()},show:function(){z.animate({width:o.width.log-o.width.userList},{duration:p.speed,easing:p.easing,complete:o.message.scroll.move})},hide:function(){z.stop().animate({width:o.width.log},{duration:p.speed,easing:p.easing,complete:o.message.scroll.move})}}},message:{scroll:{test:function(){m=z.prop("scrollHeight")-z.height(),Math.abs(z.scrollTop()-m)<p.scrollArea&&o.message.scroll.move()},move:function(){m=z.prop("scrollHeight")-z.height(),z.scrollTop(m)}},send:function(a){o.utils.emptyString(a)||b.api({url:p.endpoint.message,method:"POST",data:{message:{content:a,timestamp:(new Date).getTime()}}})},receive:function(a){k=a.data,F=u.data("users"),d=u.data("user"),void 0!==F[k.userID]&&(void 0===d||d.id!=k.userID)&&(k.user=F[k.userID],o.message.display(k))},display:function(a){z.append(p.templates.message(a)),o.message.scroll.test(),b.proxy(p.onMessage,z.children().last())()}},expand:function(){u.addClass(q.expand),b.proxy(p.onExpand,u)(),o.refresh()},contract:function(){u.removeClass(q.expand),b.proxy(p.onContract,u)(),o.refresh()},event:{input:{keydown:function(a){13==a.which&&B.addClass(q.down)},keyup:function(a){13==a.which&&(B.removeClass(q.down),o.event.submit())}},submit:function(){var a=A.val(),b=u.data("user");void 0===b||o.utils.emptyString(a)||(o.message.send(a),o.message.display({user:b,text:a}),o.message.scroll.move(),A.val(""))},toggleExpand:function(){u.hasClass(q.expand)?(v.removeClass(q.active),o.contract()):(v.addClass(q.active),o.expand())},toggleUserList:function(){z.is(":animated")||(w.hasClass(q.active)?(w.removeClass("active"),o.user.list.hide()):(w.addClass(q.active),o.user.list.show()))}},utils:{emptyString:function(a){return"string"==typeof a?-1==a.search(/\S/):!1}},setting:function(a,c){return void 0===c?p[a]:(b.isPlainObject(a)?b.extend(!0,p,a):p[a]=c,void 0)},internal:function(a,c){if(b.isPlainObject(a))b.extend(!0,o,a);else{if(void 0===c)return o[a];o[a]=c}},debug:function(){p.debug&&(p.performance?o.performance.log(arguments):(o.debug=Function.prototype.bind.call(console.info,console,p.name+":"),o.debug.apply(console,arguments)))},verbose:function(){p.verbose&&p.debug&&(p.performance?o.performance.log(arguments):(o.verbose=Function.prototype.bind.call(console.info,console,p.name+":"),o.verbose.apply(console,arguments)))},error:function(){o.error=Function.prototype.bind.call(console.error,console,p.name+":"),o.error.apply(console,arguments)},performance:{log:function(a){var b,c,d;p.performance&&(b=(new Date).getTime(),d=f||b,c=b-d,f=b,g.push({Element:D,Name:a[0],Arguments:[].slice.call(a,1)||"","Execution Time":c})),clearTimeout(o.performance.timer),o.performance.timer=setTimeout(o.performance.display,100)},display:function(){var a=p.name+":",c=0;f=!1,clearTimeout(o.performance.timer),b.each(g,function(a,b){c+=b["Execution Time"]}),a+=" "+c+"ms",e&&(a+=" '"+e+"'"),(void 0!==console.group||void 0!==console.table)&&g.length>0&&(console.groupCollapsed(a),console.table?console.table(g):b.each(g,function(a,b){console.log(b.Name+": "+b["Execution Time"]+"ms")}),console.groupEnd()),g=[]}},invoke:function(a,c,d){var e,f;return c=c||j,d=D||d,"string"==typeof a&&void 0!==C&&(a=a.split(/[\. ]/),e=a.length-1,b.each(a,function(c,d){b.isPlainObject(C[d])&&c!=e?C=C[d]:void 0!==C[d]?f=C[d]:o.error(t.method,a)})),b.isFunction(f)?f.apply(d,c):f||!1}},i?(void 0===C&&o.initialize(),o.invoke(h)):(void 0!==C&&o.destroy(),o.initialize())}),void 0!==c?c:this},b.fn.chatroom.settings={name:"Chat",debug:!1,namespace:"chat",channel:"present-chat",onJoin:function(){},onMessage:function(){},onExpand:function(){},onContract:function(){},customEvents:{},partingMessages:!1,userCount:!0,randomColor:!0,speed:300,easing:"easeOutQuint",scrollArea:9999,endpoint:{message:!1,authentication:!1},error:{method:"The method you called is not defined",endpoint:"Please define a message and authentication endpoint.",key:"You must specify a pusher key and channel.",pusher:"You must include the Pusher library."},className:{expand:"expand",active:"active",hover:"hover",down:"down",loading:"loading"},selector:{userCount:".actions .message",userListButton:".actions .list.button",expandButton:".actions .expand.button",room:".room",userList:".room .list",log:".room .log",message:".room .log .message",author:".room log .message .author",messageInput:".talk input",messageButton:".talk .send.button"},templates:{userCount:function(a){return a+" users in chat"},color:function(){var a=["#000000","#333333","#666666","#999999","#CC9999","#CC6666","#CC3333","#993333","#663333","#CC6633","#CC9966","#CC9933","#999966","#CCCC66","#99CC66","#669933","#669966","#33A3CC","#336633","#33CCCC","#339999","#336666","#336699","#6666CC","#9966CC","#333399","#663366","#996699","#993366","#CC6699"];return a[Math.floor(Math.random()*a.length)]},message:function(a){var b="";return a.user.isAdmin?(a.user.color="#55356A",b+='<div class="admin message">',b+='<span class="quirky ui flag team"></span>'):b+='<div class="message">',b+="<p>",b+=void 0!==a.user.color?'<span class="author" style="color: '+a.user.color+';">'+a.user.name+"</span>: ":'<span class="author">'+a.user.name+"</span>: ",b+=""+a.text+" </p>"+"</div>"},joined:function(a){return void 0!==typeof a.name?'<div class="status">'+a.name+" has joined the chat.</div>":!1},left:function(a){return void 0!==typeof a.name?'<div class="status">'+a.name+" has left the chat.</div>":!1},userList:function(a){var b="";return a.isAdmin&&(a.color="#55356A"),b+='<div class="user" data-id="'+a.id+'">'+' <div class="image">'+'   <img src="'+a.avatarURL+'">'+" </div>",b+=void 0!==a.color?' <p><a href="/users/'+a.id+'" target="_blank" style="color: '+a.color+';">'+a.name+"</a></p>":' <p><a href="/users/'+a.id+'" target="_blank">'+a.name+"</a></p>",b+="</div>"}}}});
