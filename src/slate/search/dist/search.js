define("slate/search/1.0.0/search",["$"],function(a){var b=a("$");b.fn.search=function(a,c){var d,e=b(this),f=e.selector||"",g=(new Date).getTime(),h=[],i=arguments[0],j="string"==typeof i,k=[].slice.call(arguments,1);return b(this).each(function(){var l,m=b.extend(!0,{},b.fn.search.settings,c),n=m.className,o=m.selector,p=m.error,q=m.namespace,r="."+q,s=q+"-module",t=b(this),u=t.find(o.prompt),v=t.find(o.searchButton),w=t.find(o.results),x=(t.find(o.result),t.find(o.category),this),y=t.data(s);l={initialize:function(){l.verbose("Initializing module");var a=u[0],b=void 0!==a.oninput?"input":void 0!==a.onpropertychange?"propertychange":"keyup";u.on("focus"+r,l.event.focus).on("blur"+r,l.event.blur).on("keydown"+r,l.handleKeyboard),m.automatic&&u.on(b+r,l.search.throttle),v.on("click"+r,l.search.query),w.on("click"+r,o.result,l.results.select),l.instantiate()},instantiate:function(){l.verbose("Storing instance of module",l),y=l,t.data(s,l)},destroy:function(){l.verbose("Destroying instance"),t.removeData(s)},event:{focus:function(){t.addClass(n.focus),l.results.show()},blur:function(){l.search.cancel(),t.removeClass(n.focus),l.results.hide()}},handleKeyboard:function(a){var c,d=t.find(o.result),e=t.find(o.category),f=a.which,g={backspace:8,enter:13,escape:27,upArrow:38,downArrow:40},h=n.active,i=d.index(d.filter("."+h)),j=d.size();if(f==g.escape&&(l.verbose("Escape key pressed, blurring search field"),u.trigger("blur")),w.filter(":visible").size()>0)if(f==g.enter){if(l.verbose("Enter key pressed, selecting active result"),d.filter("."+h).exists())return b.proxy(l.results.select,d.filter("."+h))(),a.preventDefault(),!1}else f==g.upArrow?(l.verbose("Up key pressed, changing active result"),c=0>i-1?i:i-1,e.removeClass(h),d.removeClass(h).eq(c).addClass(h).closest(e).addClass(h),a.preventDefault()):f==g.downArrow&&(l.verbose("Down key pressed, changing active result"),c=i+1>=j?i:i+1,e.removeClass(h),d.removeClass(h).eq(c).addClass(h).closest(e).addClass(h),a.preventDefault());else f==g.enter&&(l.verbose("Enter key pressed, executing query"),l.search.query(),v.addClass(n.down),u.one("keyup",function(){v.removeClass(n.down)}))},search:{cancel:function(){var a=t.data("xhr")||!1;a&&"resolved"!=a.state()&&(l.debug("Cancelling last search"),a.abort())},throttle:function(){var a=u.val(),b=a.length;clearTimeout(l.timer),b>=m.minCharacters?l.timer=setTimeout(l.search.query,m.searchThrottle):l.results.hide()},query:function(){var c=u.val(),d=l.search.cache.read(c);d?(l.debug("Reading result for '"+c+"' from cache"),l.results.add(d)):(l.debug("Querying for '"+c+"'"),"object"==typeof a?l.search.local(c):l.search.remote(c),b.proxy(m.onSearchQuery,t)(c))},local:function(c){var d,e=[],f=[],g=b.isArray(m.searchFields)?m.searchFields:[m.searchFields],h=new RegExp("(?:s|^)"+c,"i"),i=new RegExp(c,"i");t.addClass(n.loading),b.each(g,function(c,d){b.each(a,function(a,c){"string"==typeof c[d]&&-1==b.inArray(c,e)&&-1==b.inArray(c,f)&&(h.test(c[d])?e.push(c):i.test(c[d])&&f.push(c))})}),d=l.results.generate({results:b.merge(e,f)}),t.removeClass(n.loading),l.search.cache.write(c,d),l.results.add(d)},remote:function(c){var d,e={stateContext:t,url:a,urlData:{query:c},success:function(a){d=l.results.generate(a),l.search.cache.write(c,d),l.results.add(d)},failure:l.error};l.search.cancel(),l.debug("Executing search"),b.extend(!0,e,m.apiSettings),b.api(e)},cache:{read:function(a){var b=t.data("cache");return m.cache&&"object"==typeof b&&void 0!==b[a]?b[a]:!1},write:function(a,b){var c=void 0!==t.data("cache")?t.data("cache"):{};c[a]=b,t.data("cache",c)}}},results:{generate:function(a){l.debug("Generating html from response",a);var c=m.templates[m.type],d="";return b.isPlainObject(a.results)&&!b.isEmptyObject(a.results)||b.isArray(a.results)&&a.results.length>0?(m.maxResults>0&&(a.results=b.makeArray(a.results).slice(0,m.maxResults)),a.results.length>0&&(b.isFunction(c)?d=c(a):l.error(p.noTemplate,!1))):d=l.message(p.noResults,"empty"),b.proxy(m.onResults,t)(a),d},add:function(a){("default"==m.onResultsAdd||"default"==b.proxy(m.onResultsAdd,w)(a))&&w.html(a),l.results.show()},show:function(){0===w.filter(":visible").size()&&u.filter(":focus").size()>0&&""!==w.html()&&(w.stop().fadeIn(200),b.proxy(m.onResultsOpen,w)())},hide:function(){w.filter(":visible").size()>0&&(w.stop().fadeOut(200),b.proxy(m.onResultsClose,w)())},select:function(a){l.debug("Search result selected");var c=b(this),d=c.find(".title"),e=d.html();if("default"==m.onSelect||"default"==b.proxy(m.onSelect,this)(a)){var f=c.find("a[href]").eq(0),g=f.attr("href")||!1,h=f.attr("target")||!1;l.results.hide(),u.val(e),g&&("_blank"==h||a.ctrlKey?window.open(g):window.location.href=g)}}},setting:function(a,c){if(b.isPlainObject(a))b.extend(!0,m,a);else{if(void 0===c)return m[a];m[a]=c}},internal:function(a,c){if(b.isPlainObject(a))b.extend(!0,l,a);else{if(void 0===c)return l[a];l[a]=c}},debug:function(){m.debug&&(m.performance?l.performance.log(arguments):(l.debug=Function.prototype.bind.call(console.info,console,m.name+":"),l.debug.apply(console,arguments)))},verbose:function(){m.verbose&&m.debug&&(m.performance?l.performance.log(arguments):(l.verbose=Function.prototype.bind.call(console.info,console,m.name+":"),l.verbose.apply(console,arguments)))},error:function(){l.error=Function.prototype.bind.call(console.error,console,m.name+":"),l.error.apply(console,arguments)},performance:{log:function(a){var b,c,d;m.performance&&(b=(new Date).getTime(),d=g||b,c=b-d,g=b,h.push({Element:x,Name:a[0],Arguments:[].slice.call(a,1)||"","Execution Time":c})),clearTimeout(l.performance.timer),l.performance.timer=setTimeout(l.performance.display,100)},display:function(){var a=m.name+":",c=0;g=!1,clearTimeout(l.performance.timer),b.each(h,function(a,b){c+=b["Execution Time"]}),a+=" "+c+"ms",f&&(a+=" '"+f+"'"),e.size()>1&&(a+=" ("+e.size()+")"),(void 0!==console.group||void 0!==console.table)&&h.length>0&&(console.groupCollapsed(a),console.table?console.table(h):b.each(h,function(a,b){console.log(b.Name+": "+b["Execution Time"]+"ms")}),console.groupEnd()),h=[]}},invoke:function(a,c,e){var f,g,h,i=y;return c=c||k,e=x||e,"string"==typeof a&&void 0!==i&&(a=a.split(/[\. ]/),f=a.length-1,b.each(a,function(c,d){var e=c!=f?d+a[c+1].charAt(0).toUpperCase()+a[c+1].slice(1):a;if(b.isPlainObject(i[e])&&c!=f)i=i[e];else{if(void 0!==i[e])return g=i[e],!1;if(!b.isPlainObject(i[d])||c==f)return void 0!==i[d]?(g=i[d],!1):!1;i=i[d]}})),b.isFunction(g)?h=g.apply(e,c):void 0!==g&&(h=g),b.isArray(d)?d.push(h):void 0!==d?d=[d,h]:void 0!==h&&(d=h),g}},j?(void 0===y&&l.initialize(),l.invoke(i)):(void 0!==y&&l.destroy(),l.initialize())}),void 0!==d?d:this},b.fn.search.settings={name:"Search Module",namespace:"search",debug:!1,verbose:!0,performance:!0,onSelect:"default",onResultsAdd:"default",onSearchQuery:function(){},onResults:function(){},onResultsOpen:function(){},onResultsClose:function(){},automatic:"true",type:"simple",minCharacters:3,searchThrottle:300,maxResults:7,cache:!0,searchFields:["title","description"],apiSettings:{},className:{active:"active",down:"down",focus:"focus",empty:"empty",loading:"loading"},error:{noResults:"Your search returned no results",logging:"Error in debug logging, exiting.",noTemplate:"A valid template name was not specified.",serverError:"There was an issue with querying the server.",method:"The method you called is not defined."},selector:{prompt:".prompt",searchButton:".search.button",results:".results",category:".category",result:".result"},templates:{message:function(a,b){var c="";return void 0!==a&&void 0!==b&&(c+='<div class="message '+b+'">',c+="empty"==b?'<div class="header">No Results</div class="header"><div class="description">'+a+'</div class="description">':' <div class="description">'+a+"</div>",c+="</div>"),c},categories:function(a){var c="";return void 0!==a.results?(b.each(a.results,function(a,d){void 0!==d.results&&d.results.length>0&&(c+='<div class="category"><div class="name">'+d.name+"</div>",b.each(d.results,function(a,b){c+='<div class="result">',c+='<a href="'+b.url+'"></a>',void 0!==b.image&&(c+='<div class="image"> <img src="'+b.image+'">'+"</div>"),c+='<div class="info">',void 0!==b.price&&(c+='<div class="price">'+b.price+"</div>"),void 0!==b.title&&(c+='<div class="title">'+b.title+"</div>"),void 0!==b.description&&(c+='<div class="description">'+b.description+"</div>"),c+="</div></div>"}),c+="</div>")}),a.resultPage&&(c+='<a href="'+a.resultPage.url+'" class="all">'+a.resultPage.text+"</a>"),c):!1},simple:function(a){var c="";return void 0!==a.results?(b.each(a.results,function(a,b){c+='<a class="result" href="'+b.url+'">',void 0!==b.image&&(c+='<div class="image"> <img src="'+b.image+'">'+"</div>"),c+='<div class="info">',void 0!==b.price&&(c+='<div class="price">'+b.price+"</div>"),void 0!==b.title&&(c+='<div class="title">'+b.title+"</div>"),void 0!==b.description&&(c+='<div class="description">'+b.description+"</div>"),c+="</div></a>"}),a.resultPage&&(c+='<a href="'+a.resultPage.url+'" class="all">'+a.resultPage.text+"</a>"),c):!1}}}});
